<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interfaz Simplificada</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap");

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(to bottom, #d3d3d3, #ffffff);
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
    }

    .main-content {
      margin-top: 100px;
      margin-left: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: calc(100% - 160px);
      height: auto;
    }

    .options-bar {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: space-evenly;
      position: fixed;
      top: 0;
      left: 0;
      background: rgba(255, 255, 255, 0.9);
      width: 170px;
      height: 100%;
      box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.1);
      padding: 20px 10px;
      z-index: 1000;
    }

    .option {
      display: flex;
      align-items: center;
    }

    .options-bar img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease;
      margin-right: 10px;
    }

    .options-bar img:hover {
      transform: scale(1.1);
    }

    .option-text {
      font-size: 14px;
      font-weight: 400;
      color: #333;
    }

   .profile-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin: 50px 0;
}

.profile-details {
  position: absolute; 
  top: 280px; 
  left: 350px; 
  text-align: left;
  color: #333; 
  padding: 0; 
  background-color: transparent; 
  width: 250px; 
  z-index: 2; 
}


.profile-stats-buttons {
  display: flex;
  flex-direction: row; 
  align-items: center;
  gap: 240px;
  position: relative;
  top: -150px; 
  margin-left: 380px; 
}


.profile-stats {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.stats-row {
  display: flex;
  gap: 60px;
}

.stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 14px;
}

.stat-number {
  font-weight: 600;
  font-size: 18px;
  margin-bottom: 5px;
}

.profile-buttons {
  display: flex;
  flex-direction: row; 
  gap: 20px;
}


.button-container {
  display: flex;
  flex-direction: row; 
  gap: 30px; 


}



.posts-section {
  display: flex;
  align-items: center;
  justify-content: flex-start; 
  gap: 20px; 
  margin-top: 160px; 
  width: 80%; 
  padding: 20px; 
  background-color: #f5f5f5; 
  border-radius: 10px; 
  position: relative;
  left: 250px; 
}




.circle {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  background-image: url('img/perfil.jpg'); 
  margin-left: -1000px; 
  margin-top: -100px; 
  border: 5px solid white; 
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); 
}



.settings-bar .option {
  display: flex;
  align-items: center;
  gap: 10px; 
  cursor: pointer;
  padding-left: 20px; 
}


.settings-bar img {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  transition: transform 0.3s ease;
}

.settings-bar img:hover {
  transform: scale(1.1); 
}

.settings-bar .option-text {
  font-size: 14px;
  font-weight: 400;
  color: #333;
}

.settings-bar a {
  text-decoration: none; 
  color: inherit; 
  display: flex; 
  align-items: center;
  gap: 10px; 
  cursor: pointer;
}

.settings-bar a:hover {
  color: #B22222; 
}

.photo-container {
  width: 95%; 
  max-width: 1350px; 
  height: 400px; 
  margin: 20px auto; 
  border: 2px dashed #ccc; 
  border-radius: 10px; 
  background-color: #f9f9f9; 
  display: flex;
  flex-wrap: wrap; 
  gap: 10px; 
  padding: 20px; 
  overflow-y: auto; 
  margin-left: 250px; 
}



    .modal-backdrop {
    background-color: transparent !important; 
}


  .modal-content {
    background: transparent;
    border: none;
    box-shadow: none;
  }

  .modal-dialog {
    background-color: transparent !important; 
}


 .nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.3);
    border: none;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
    z-index: 1050;
  }

  .nav-arrow:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }

  .prev-arrow {
    left: 10px;
  }

  .next-arrow {
    right: 10px;
  }


  .modal-content {
    background: transparent;
    border: none;
    box-shadow: none;
  }


  .btn-close-white {
    filter: invert(1);
  }


  iframe {
    background-color: rgba(0, 0, 0, 0.8);
    border-radius: 10px;
  }

  #follow-button-container {
    width: 100%;
    display: flex;
    justify-content: flex-start; /* Alinea el botón a la izquierda */
    margin-top: 50px; /* Espacio debajo de la biografía */
    margin-left: 320px; /* Ajusta este valor según lo que necesites */
}

#follow-button {
    width: 300px; /* Más ancho */
    padding: 12px;
    font-size: 18px;
    background-color: #c94646;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
}

#follow-button:hover {
    background-color: #857a7a;
}




  </style>
</head>
<body>

  <div class="options-bar">
    <div class="option">
      <img src="img/usuario.png" alt="Usuario">
      <span class="option-text">Usuario</span>
    </div>
    <div class="option">
      <img src="img/explorar.png" alt="Explorar">
      <span class="option-text">Explorar</span>
    </div>
    <div class="option">
      <img src="img/chats.png" alt="Chats">
      <span class="option-text">Chats</span>
    </div>
    <div class="option">
      <img src="img/grupo.png" alt="Grupo">
      <span class="option-text">Grupo</span>
    </div>
    <div class="option">
      <img src="img/foro.png" alt="Foro">
      <span class="option-text">Foro</span>
    </div>
    <div class="option">
      <img src="img/canal.png" alt="Canal">
      <span class="option-text">Canal</span>
    </div>
    <div class="option">
      <img src="img/evento.png" alt="Evento">
      <span class="option-text">Evento</span>
    </div>
    <div class="option">
      <img src="img/calendario.png" alt="Calendario">
      <span class="option-text">Calendario</span>
    </div>
    <div class="option">
      <img src="img/live.png" alt="Live">
      <span class="option-text">Live</span>
    </div>
  </div>

  <div class="main-content">
  <div class="profile-section">
  <div class="circle profile-image" id="profileImage"></div>
 <div class="profile-details" id="profileDetails"></div>
  
 



</div>

<div class="profile-stats-buttons">
  <div class="profile-stats">
    <div class="stats-row">

     
     <div class="stat" data-bs-toggle="modal" data-bs-target="#amigosModal">
      <div class="stat-number">A</div>
      Seguidores
  </div>

  
  <div class="stat" data-bs-toggle="modal" data-bs-target="#seguidosModal">
      <div class="stat-number">X</div>
      Seguidos
  </div>

  
  <div class="stat" data-bs-toggle="modal" data-bs-target="#comunidadesModal">
      <div class="stat-number">'s</div>
      Comunidades
  </div>

    </div>
  </div>

</div>

    </div>
  </div>


  <div id="follow-button-container">
    <button id="follow-button" class="btn btn-primary">Seguir</button>
  </div>

  <div class="posts-section">
  <span>Publicaciones</span>
 
</div>

 <div class="photo-container" id="photo-container"></div>

</div>

<div class="modal fade" id="amigosModal" tabindex="-1" aria-labelledby="amigosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="amigosModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="amigosModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="seguidosModal" tabindex="-1" aria-labelledby="seguidosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="seguidosModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="seguidosModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="comunidadesModal" tabindex="-1" aria-labelledby="comunidadesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="comunidadesModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="comunidadesModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="crearPerfilDeportistaModal" tabindex="-1" aria-labelledby="crearPerfilDeportistaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crearPerfilDeportistaLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="crearperfildeportista.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="crearPerfilApasionadoModal" tabindex="-1" aria-labelledby="crearPerfilApasionadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crearPerfilApasionadoLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="crearperfilapasionado.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="modificarPerfilDeportistaModal" tabindex="-1" aria-labelledby="modificarPerfilDeportistaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarPerfilDeportistaLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="modificarperfildeportista.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="modificarPerfilApasionadoModal" tabindex="-1" aria-labelledby="modificarPerfilApasionadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarPerfilApasionadoLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="modificarperfilapasionado.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" style="background-color: transparent;">
    <div class="modal-content" style="background: transparent; border: none;">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body position-relative d-flex align-items-center justify-content-center">
        <button id="prevButton" class="btn nav-arrow prev-arrow" onclick="navigateImage(-1)">
          &lt;
        </button>
        <iframe id="postIframe" src="" style="width: 100%; height: 500px; border: none; border-radius: 10px; background-color: rgba(0, 0, 0, 0.5);"></iframe>
        <button id="nextButton" class="btn nav-arrow next-arrow" onclick="navigateImage(1)">
          &gt;
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
      console.log("📌 Script de perfil público cargado correctamente.");
  
      function getEmailFromURL() {
          const params = new URLSearchParams(window.location.search);
          return params.get('email');
      }
  
      const email = getEmailFromURL();
      const emailUsuarioAutenticado = localStorage.getItem('email'); 

      if (!email) {
          console.error("❌ No se encontró el email en la URL.");
          return;
      }
  
      let currentIndex = 0;
      let imageArray = [];
      let modalData = {};
      let isFollowing = false;

      // Evitar auto-seguimiento
      if (email === emailUsuarioAutenticado) {
          console.warn("⚠️ Un usuario no puede seguirse a sí mismo.");
          document.getElementById('follow-button').style.display = 'none';
      } else {
          await verificarSeguimiento(emailUsuarioAutenticado, email);
      }

      async function cargarDatosPerfil() {
          try {
              const response = await fetch('http://localhost:5000/api/perfil/datos', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email }),
              });

              const data = await response.json();
              console.log("Datos recibidos del servidor:", data);  

              if (data.success) {
                  document.getElementById('profileImage').style.backgroundImage = `url('${data.fotoPerfil || 'img/perfil.jpg'}')`;

                  document.getElementById('profileDetails').innerHTML = `
                      <p><strong>${data.username}</strong> - ${data.tipoUsuario}</p>
                      <p><strong>Biografía:</strong> ${data.biografia || 'N/A'}</p>
                  `;

                  await cargarEstadisticas(email);
              } else {
                  console.error(' Error al obtener los datos del perfil:', data.message);
              }
          } catch (error) {
              console.error(' Error al cargar los datos del perfil:', error);
          }
      }

      async function cargarEstadisticas(email) {
          try {
              const response = await fetch('http://localhost:5000/api/perfil/stats', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email }),
              });

              const data = await response.json();
              if (data.success) {
                  document.querySelector('[data-bs-target="#amigosModal"] .stat-number').textContent = data.stats.seguidores ?? "0";
                  document.querySelector('[data-bs-target="#seguidosModal"] .stat-number').textContent = data.stats.seguidos ?? "0";
                  document.querySelector('[data-bs-target="#comunidadesModal"] .stat-number').textContent = data.stats.comunidades ?? "0";
              } else {
                  console.error("Error al obtener estadísticas:", data.message);
              }
          } catch (error) {
              console.error("❌ Error al obtener estadísticas:", error);
          }
      }

      async function cargarPublicaciones() {
          try {
              const response = await fetch('http://localhost:5000/api/perfil/obtener-publicaciones', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email }),
              });

              const data = await response.json();
              if (data.success) {
                  imageArray = data.publicaciones.map(({ id, imagen, comentarios, usuario, fotoPerfil }) => ({
                      id,
                      src: imagen,
                      comentarios,
                      usuario,
                      fotoPerfil
                  }));

                  modalData = {};
                  const container = document.getElementById('photo-container');
                  container.innerHTML = '';

                  imageArray.forEach(({ id, src }) => {
                      createImageElement(id, src);
                  });

                  console.log(` Se han cargado ${imageArray.length} imágenes.`);
              } else {
                  console.error(' Error al obtener las publicaciones:', data.message);
              }
          } catch (error) {
              console.error(' Error al obtener las publicaciones:', error);
          }
      }

      function createImageElement(id, src) {
          const container = document.getElementById('photo-container');
          const img = document.createElement('img');
          img.src = src;
          img.dataset.id = id;
          img.style.width = '250px';
          img.style.height = '250px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '5px';
          img.style.cursor = 'pointer';

          img.addEventListener('click', () => handleImageClick(id, src));
          container.appendChild(img);
          console.log(` Imagen agregada: ID=${id}, SRC=${src}`);
      }

      function handleImageClick(id, imageSrc) {
          console.log(`Click en imagen - ID: ${id}, SRC: ${imageSrc}`);
          currentIndex = imageArray.findIndex((img) => img.id === id);
          const iframe = document.getElementById('postIframe');

          if (!iframe) {
              console.error(" Error: No se encontró el iframe del modal.");
              return;
          }

          iframe.src = `post.html?id=${id}&image=${encodeURIComponent(imageSrc)}`;
      }

      async function verificarSeguimiento(myEmail, targetEmail) {
          try {
              const response = await fetch('http://localhost:5000/api/perfil/no-seguidos', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email: myEmail, amigoEmail: targetEmail }),
              });

              const data = await response.json();
              const followButton = document.getElementById('follow-button');

              if (data.success) {
                  isFollowing = data.sonAmigos;
                  updateFollowButton();
              }
          } catch (error) {
              console.error("Error al verificar seguimiento:", error);
          }
      }

      async function agregarAmigo(emailToFollow) {
    try {
        const response = await fetch('http://localhost:5000/api/perfil/agregar-amigo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: emailUsuarioAutenticado, amigoEmail: emailToFollow }),
        });

        const data = await response.json();
        if (data.success) {
            isFollowing = true;
            updateFollowButton();
            await cargarEstadisticas(emailToFollow);

            
            await enviarNotificacionSeguidor(emailUsuarioAutenticado, emailToFollow);
        }
    } catch (error) {
        console.error('Error en la solicitud de seguir:', error);
    }
}

async function enviarNotificacionSeguidor(emailSeguidor, emailSeguido) {
    try {
        const response = await fetch('http://localhost:5000/api/notificaciones/nuevo-seguidor', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ emailSeguidor, emailSeguido }),
        });

        const data = await response.json();
        if (data.success) {
            console.log('Notificación de nuevo seguidor enviada correctamente.');
        } else {
            console.error('Error al enviar notificación de nuevo seguidor:', data.message);
        }
    } catch (error) {
        console.error('Error en la solicitud de notificación:', error);
    }
}

      async function eliminarAmigo(emailToFollow) {
          try {
              const response = await fetch('http://localhost:5000/api/perfil/eliminar-amigo-unilateral', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email: emailUsuarioAutenticado, amigoEmail: emailToFollow }),
              });

              const data = await response.json();
              if (data.success) {
                  isFollowing = false;
                  updateFollowButton();
                  await cargarEstadisticas(emailToFollow);
              }
          } catch (error) {
              console.error('Error en la solicitud de eliminar amigo:', error);
          }
      }

      function updateFollowButton() {
          const followButton = document.getElementById('follow-button');
          if (isFollowing) {
              followButton.textContent = 'Siguiendo';
              followButton.classList.remove('btn-primary');
              followButton.classList.add('btn-secondary');
          } else {
              followButton.textContent = 'Seguir';
              followButton.classList.remove('btn-secondary');
              followButton.classList.add('btn-primary');
          }
      }

      document.getElementById('follow-button').addEventListener('click', async () => {
          if (isFollowing) {
              await eliminarAmigo(email);
          } else {
              await agregarAmigo(email);
          }
      });

      await cargarDatosPerfil();
      await cargarPublicaciones();
  });
</script>


  

</body>
</html>

