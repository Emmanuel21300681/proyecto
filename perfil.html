<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interfaz Simplificada</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap");

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(to bottom, #d3d3d3, #ffffff);
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
    }

    .main-content {
      margin-top: 100px;
      margin-left: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: calc(100% - 160px);
      height: auto;
    }

    .options-bar {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: space-evenly;
      position: fixed;
      top: 0;
      left: 0;
      background: rgba(255, 255, 255, 0.9);
      width: 170px;
      height: 100%;
      box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.1);
      padding: 20px 10px;
      z-index: 1000;
    }

    .option {
      display: flex;
      align-items: center;
    }

    .options-bar img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease;
      margin-right: 10px;
    }

    .options-bar img:hover {
      transform: scale(1.1);
    }

    .option-text {
      font-size: 14px;
      font-weight: 400;
      color: #333;
    }

   .profile-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin: 50px 0;
}

.profile-details {
  position: absolute; 
  top: 280px; 
  left: 350px; 
  text-align: left;
  color: #333; 
  padding: 0; 
  background-color: transparent; 
  width: 250px; 
  z-index: 2; 
}


.profile-stats-buttons {
  display: flex;
  flex-direction: row; 
  align-items: center;
  gap: 240px;
  position: relative;
  top: -150px; 
  margin-left: 380px; 
}


.profile-stats {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.stats-row {
  display: flex;
  gap: 60px;
}

.stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 14px;
}

.stat-number {
  font-weight: 600;
  font-size: 18px;
  margin-bottom: 5px;
}

.profile-buttons {
  display: flex;
  flex-direction: row; 
  gap: 20px;
}


.button-container {
  display: flex;
  flex-direction: row; 
  gap: 30px; 


}

.button-circle {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  cursor: pointer;
  background-image: url('img/configuracion.png'); 
}

.button-square {
  width: 50px;
  height: 50px;
  background-size: cover;
  background-position: center;
  cursor: pointer;
  background-image: url('img/buzon.png'); 
}

.button-sugerencias {
  width: 50px;
  height: 50px;
  border-radius: 10px; 
  background-size: cover;
  background-position: center;
  cursor: pointer;
  background-image: url('img/sugerencias.png'); 
  transition: background-image 0.3s ease; 
}



.posts-section {
  display: flex;
  align-items: center;
  justify-content: flex-start; 
  gap: 20px; 
  margin-top: 160px; 
  width: 80%; 
  padding: 20px; 
  background-color: #f5f5f5; 
  border-radius: 10px; 
  position: relative;
  left: 250px; 
}


.add-post-button {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  background-color: #db4437;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
}

.add-post-button:hover {
  background-color: #c33c2e;
}

.circle {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  background-image: url('img/perfil.jpg'); 
  margin-left: -1000px; 
  margin-top: -100px; 
  border: 5px solid white; 
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); 
}



.settings-bar {
  position: fixed;
  top: 0;
  right: -250px; 
  width: 250px;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.9); 
  box-shadow: -2px 0px 5px rgba(0, 0, 0, 0.1);
  transition: right 0.3s ease; 
  z-index: 1001;
  padding: 20px 10px;
  display: flex;
  flex-direction: column;
  gap: 40px; 
}

.settings-bar .option {
  display: flex;
  align-items: center;
  gap: 10px; 
  cursor: pointer;
  padding-left: 20px; 
}


.settings-bar img {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  transition: transform 0.3s ease;
}

.settings-bar img:hover {
  transform: scale(1.1); 
}

.settings-bar .option-text {
  font-size: 14px;
  font-weight: 400;
  color: #333;
}

.settings-bar a {
  text-decoration: none; 
  color: inherit; 
  display: flex; 
  align-items: center;
  gap: 10px; 
  cursor: pointer;
}

.settings-bar a:hover {
  color: #B22222; 
}

.photo-container {
  width: 95%; 
  max-width: 1350px; 
  height: 400px; 
  margin: 20px auto; 
  border: 2px dashed #ccc; 
  border-radius: 10px; 
  background-color: #f9f9f9; 
  display: flex;
  flex-wrap: wrap; 
  gap: 10px; 
  padding: 20px; 
  overflow-y: auto; 
  margin-left: 250px; 
}



    .modal-backdrop {
    background-color: transparent !important; 
}


  .modal-content {
    background: transparent;
    border: none;
    box-shadow: none;
  }

  .modal-dialog {
    background-color: transparent !important; 
}


 .nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.3);
    border: none;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.2s ease;
    z-index: 1050;
  }

  .nav-arrow:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }

  .prev-arrow {
    left: 10px;
  }

  .next-arrow {
    right: 10px;
  }


  .modal-content {
    background: transparent;
    border: none;
    box-shadow: none;
  }


  .btn-close-white {
    filter: invert(1);
  }


  iframe {
    background-color: rgba(0, 0, 0, 0.8);
    border-radius: 10px;
  }






  </style>
</head>
<body>

  <div class="options-bar">
    <div class="option">
      <img src="img/usuario.png" alt="Usuario">
      <span class="option-text">Usuario</span>
    </div>
    <div class="option">
      <img src="img/explorar.png" alt="Explorar">
      <span class="option-text">Explorar</span>
    </div>
    <div class="option">
      <img src="img/chats.png" alt="Chats">
      <span class="option-text">Chats</span>
    </div>
    <div class="option">
      <img src="img/grupo.png" alt="Grupo">
      <span class="option-text">Grupo</span>
    </div>
    <div class="option">
      <img src="img/foro.png" alt="Foro">
      <span class="option-text">Foro</span>
    </div>
    <div class="option">
      <img src="img/canal.png" alt="Canal">
      <span class="option-text">Canal</span>
    </div>
    <div class="option">
      <img src="img/evento.png" alt="Evento">
      <span class="option-text">Evento</span>
    </div>
    <div class="option">
      <img src="img/calendario.png" alt="Calendario">
      <span class="option-text">Calendario</span>
    </div>
    <div class="option">
      <img src="img/live.png" alt="Live">
      <span class="option-text">Live</span>
    </div>
  </div>

  <div class="main-content">
  <div class="profile-section">
  <div class="circle profile-image" id="profileImage"></div>
 <div class="profile-details" id="profileDetails"></div>


</div>

<div class="profile-stats-buttons">
  <div class="profile-stats">
    <div class="stats-row">

     <!-- Seguidores -->
     <div class="stat" data-bs-toggle="modal" data-bs-target="#amigosModal">
      <div class="stat-number">A</div>
      Seguidores
  </div>

  <!-- Seguidos -->
  <div class="stat" data-bs-toggle="modal" data-bs-target="#seguidosModal">
      <div class="stat-number">X</div>
      Seguidos
  </div>

  <!-- Comunidades -->
  <div class="stat" data-bs-toggle="modal" data-bs-target="#comunidadesModal">
      <div class="stat-number">'s</div>
      Comunidades
  </div>

    </div>
  </div>

  <div class="profile-buttons">
    <div class="button-square" onclick="temporaryImageChange(this, 'img/buzon2.png', 'img/buzon.png')" data-bs-toggle="modal" data-bs-target="#solicitudesModal"></div>
    <div class="button-sugerencias" onclick="temporaryImageChange(this, 'img/sugerencias2.png', 'img/sugerencias.png')" data-bs-toggle="modal" data-bs-target="#sugerenciasModal"></div>
    <div class="button-circle settings-button" onclick="temporaryImageChange(this, 'img/configuracion2.png', 'img/configuracion.png')"></div>
  </div>

</div>

   

    </div>
  </div>

  <div class="posts-section">
  <span>Publicaciones</span>
  <button class="add-post-button" onclick="document.getElementById('file-input').click()">+</button>
  <input id="file-input" type="file" style="display: none;" multiple onchange="handleFileUpload(event)" />
</div>

 <div class="photo-container" id="photo-container"></div>




</div>

<div id="settings-bar" class="settings-bar">
<div class="option" data-bs-toggle="modal" data-bs-target="#notificacionesModal">
    <img src="img/notis.png" alt="Notificaciones">
    <span class="option-text">Notificaciones</span>
  </div>
<div class="option">
  <img src="img/editar.png" alt="Editar Perfil">
  <span class="option-text">Editar Perfil</span>
</div>
  <div class="option" data-bs-toggle="modal" data-bs-target="#contraseñaModal">
    <img src="img/contraseña.png" alt="Contraseña">
    <span class="option-text">Contraseña</span>
  </div>
  <div class="option" data-bs-toggle="modal" data-bs-target="#bloqueadosModal">
    <img src="img/bloquear.png" alt="Bloquear">
    <span class="option-text">Bloqueados</span>
  </div>
  <a href="registro.html" class="option">
    <img src="img/cerrarsesion.png" alt="Cerrar Sesión">
    <span class="option-text">Cerrar Sesión</span>
  </a>
</div>


<div class="modal fade" id="notificacionesModal" tabindex="-1" aria-labelledby="notificacionesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="notificacionesModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <iframe src="notificaciones.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="bloqueadosModal" tabindex="-1" aria-labelledby="bloqueadosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bloqueadosModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <iframe src="bloqueadosModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="contraseñaModal" tabindex="-1" aria-labelledby="contraseñaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="contraseñaModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="contraseña2.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="solicitudesModal" tabindex="-1" aria-labelledby="solicitudesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="solicitudesModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="solicitudesModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="sugerenciasModal" tabindex="-1" aria-labelledby="sugerenciasModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sugerenciasModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="sugerenciasModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="amigosModal" tabindex="-1" aria-labelledby="amigosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="amigosModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="amigosModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="seguidosModal" tabindex="-1" aria-labelledby="seguidosModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="seguidosModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="seguidosModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="comunidadesModal" tabindex="-1" aria-labelledby="comunidadesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="comunidadesModalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="comunidadesModal.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="crearPerfilDeportistaModal" tabindex="-1" aria-labelledby="crearPerfilDeportistaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crearPerfilDeportistaLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="crearperfildeportista.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="crearPerfilApasionadoModal" tabindex="-1" aria-labelledby="crearPerfilApasionadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="crearPerfilApasionadoLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="crearperfilapasionado.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="modificarPerfilDeportistaModal" tabindex="-1" aria-labelledby="modificarPerfilDeportistaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarPerfilDeportistaLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="modificarperfildeportista.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="modificarPerfilApasionadoModal" tabindex="-1" aria-labelledby="modificarPerfilApasionadoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarPerfilApasionadoLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe src="modificarperfilapasionado.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>
</div>




<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" style="background-color: transparent;">
    <div class="modal-content" style="background: transparent; border: none;">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body position-relative d-flex align-items-center justify-content-center">
        <button id="prevButton" class="btn nav-arrow prev-arrow" onclick="navigateImage(-1)">
          &lt;
        </button>
        <iframe id="postIframe" src="" style="width: 100%; height: 500px; border: none; border-radius: 10px; background-color: rgba(0, 0, 0, 0.5);"></iframe>
        <button id="nextButton" class="btn nav-arrow next-arrow" onclick="navigateImage(1)">
          &gt;
        </button>
      </div>
    </div>
  </div>
</div>




<script>
    
    let currentIndex = 0; 
    const settingsBar = document.getElementById('settings-bar');
    const settingsButton = document.querySelector('.settings-button');
    let imageArray = []; 
    let modalData = {}; 

    
    function temporaryImageChange(element, newImage, originalImage) {
        element.style.backgroundImage = `url('${newImage}')`;
        setTimeout(() => {
            element.style.backgroundImage = `url('${originalImage}')`;
        }, 300);
    }

    
    settingsButton.addEventListener('click', (event) => {
        event.stopPropagation(); 
        if (settingsBar.style.right === '0px') {
            settingsBar.style.right = '-250px'; 
        } else {
            settingsBar.style.right = '0px'; 
        }
    });


    document.addEventListener('click', (event) => {
        if (
            settingsBar.style.right === '0px' && 
            !settingsBar.contains(event.target) && 
            event.target !== settingsButton 
        ) {
            settingsBar.style.right = '-250px'; 
        }
    });


    function saveToLocalStorage() {
        localStorage.setItem('uploadedImages', JSON.stringify(imageArray));
        localStorage.setItem('modalData', JSON.stringify(modalData));
    }


    function loadFromLocalStorage() {
    const storedImages = JSON.parse(localStorage.getItem('uploadedImages')) || [];
    const storedModalData = JSON.parse(localStorage.getItem('modalData')) || {};

    imageArray = storedImages.filter(({ id }) => id && id.trim() !== '');
    modalData = storedModalData;

    const container = document.getElementById('photo-container');
    container.innerHTML = ''; 

    imageArray.forEach(({ id, src }) => {
        createImageElement(id, src);
    });
}


    function isValidImageSrc(src) {
        return src && src.startsWith('data:image/');
    }


    function createImageElement(id, src) {
        const container = document.getElementById('photo-container');

        const img = document.createElement('img');
        img.src = src;
        img.dataset.id = id;
        img.style.width = '250px';
        img.style.height = '250px';
        img.style.objectFit = 'cover';
        img.style.borderRadius = '5px';
        img.style.cursor = 'pointer';

        img.onclick = () => handleImageClick(id, src); 

        container.appendChild(img); 
    }

  

   function handleImageClick(id, imageSrc) {
    currentIndex = imageArray.findIndex((img) => img.id === id);

    const iframe = document.getElementById('postIframe');

    if (!id || !imageSrc) {
        console.error('Error: ID o imagen no proporcionados.');
        return;
    }


    iframe.src = 'about:blank';

    setTimeout(() => {
        iframe.src = `postcreador.html?id=${id}&image=${encodeURIComponent(imageSrc)}`;

        iframe.onload = () => {
            iframe.contentWindow.postMessage(
                {
                    action: 'loadData',
                    data: modalData[id] || { likes: 0, comments: [] },
                },
                '*'
            );

            const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('imageModal'));
            modal.show();
        };
    }, 50);
}

function showImageAtIndex(index) {
    if (imageArray.length === 0) return;

    currentIndex = (index + imageArray.length) % imageArray.length;

    const { id, src } = imageArray[currentIndex];
    const iframe = document.getElementById('postIframe');

    iframe.src = 'about:blank'; 

    setTimeout(() => {
        iframe.src = `postcreador.html?id=${id}&image=${encodeURIComponent(src)}`;

        iframe.onload = () => {
            iframe.contentWindow.postMessage(
                {
                    action: 'loadData',
                    data: modalData[id] || { likes: 0, comments: [] },
                },
                '*'
            );
        };

        iframe.onerror = () => {
            console.error('Error al cargar la publicación.');
            alert('No se pudo cargar la publicación. Intenta nuevamente.');
        };
    }, 50);
}





    function nextImage() {
        showImageAtIndex(currentIndex + 1);
    }


    function prevImage() {
        showImageAtIndex(currentIndex - 1);
    }

 
    document.getElementById('nextButton').addEventListener('click', nextImage);
    document.getElementById('prevButton').addEventListener('click', prevImage);

async function handleFileUpload(event) {
  const formData = new FormData();
  formData.append('image', event.target.files[0]); 

  try {
    const response = await fetch('http://localhost:5000/api/imagen/upload', {
      method: 'POST',
      body: formData,  
    });

    if (!response.ok) {
      throw new Error('Error al subir la imagen.');
    }

    const result = await response.json(); 
    if (result.success) {
      console.log('Imagen subida correctamente:', result.url);
      

      const postUrl = `postsubir.html?image=${encodeURIComponent(result.url)}`;
      window.location.href = postUrl;  
    } else {
      alert('Imagen mayor a 10mb');
      console.error('Error en la subida de la imagen:', result.message);
    }
  } catch (error) {
    alert('Imagen mayor a 10mb');
    console.error('Error al subir la imagen:', error);
  }
}





    
    window.addEventListener('message', (event) => {
    if (event.data.action === 'deletePost') {
        const { id } = event.data;

        imageArray = imageArray.filter((img) => img.id !== id);
        delete modalData[id]; 

        saveToLocalStorage(); 


        const imageElement = document.querySelector(`img[data-id="${id}"]`);
        if (imageElement) {
            imageElement.parentNode.removeChild(imageElement);
        }
    }
});

    
    document.addEventListener('DOMContentLoaded', loadFromLocalStorage);
</script>


<script>
document.addEventListener('DOMContentLoaded', () => {
  const email = localStorage.getItem('email');
  if (!email) {
    console.error('No se encontró el email en localStorage.');
    return;
  }

  fetch('http://localhost:5000/api/perfil/obtener-publicaciones', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
    })
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                imageArray = data.publicaciones.map(({ id, imagen }) => ({ id, src: imagen }));
                modalData = {}; 

                const container = document.getElementById('photo-container');
                container.innerHTML = ''; 

                imageArray.forEach(({ id, src }) => {
                    createImageElement(id, src);
                });

                saveToLocalStorage(); 
            } else {
                console.error('Error al obtener las publicaciones:', data.message);
            }
        })
        .catch((error) => console.error('Error al obtener las publicaciones:', error));
});

</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  
  const email = localStorage.getItem('email');
  if (!email) {
    console.error("No se encontró el email en localStorage.");
    return;
  }

  
 fetch('http://localhost:5000/api/perfil/estado', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        if (!data.perfilCompleto) {
          const modalId = data.tipoUsuario === 'Deportista'
            ? 'crearPerfilDeportistaModal'
            : 'crearPerfilApasionadoModal';

          const modalElement = document.getElementById(modalId);
          if (modalElement) {
            const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
            modal.show();
          } else {
            console.error(`No se encontró el modal con ID: ${modalId}`);
          }
        } else {
          
          const modalElement = document.querySelector('.modal.show');
          if (modalElement) {
            const modalInstance = bootstrap.Modal.getInstance(modalElement);
            if (modalInstance) {
              modalInstance.hide();
            }
          }
          const backdrops = document.querySelectorAll('.modal-backdrop');
          backdrops.forEach((backdrop) => backdrop.remove());
        }
      } else {
        console.error('Error del servidor:', data.message);
      }
    })
    .catch((error) => {
      console.error('Error al verificar el perfil:', error);
    });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', () => {
  const email = localStorage.getItem('email'); 
  if (!email) {
    console.error("No se encontró el email en localStorage.");
    return;
  }

  
  fetch('http://localhost:5000/api/perfil/datos', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email }), 
  })
    .then(response => response.json())
    .then(data => {
      console.log('Datos recibidos:', data); 

      if (data.success) {
        
        const profileImage = document.getElementById('profileImage');
        profileImage.style.backgroundImage = `url('${data.fotoPerfil || 'img/perfil.jpg'}')`;

        
        const profileDetails = document.getElementById('profileDetails');
     profileDetails.innerHTML = `
  <p><strong>${data.username} </strong> - ${data.tipoUsuario}</p>
  ${data.tipoUsuario === 'Deportista' ? `
    <p><strong>Nivel:</strong> ${data.nivel || 'N/A'}</p>
    <p><strong>Logros:</strong> ${data.logros || 'N/A'}</p>
    <p><strong>Biografía:</strong> ${data.biografia || 'N/A'}</p>
  ` : `
    <p><strong>Biografía:</strong> ${data.biografia || 'N/A'}</p>
  `}
`;

      } else {
        console.error('Error al obtener los datos del perfil:', data.message);
      }
    })
    .catch(error => {
      console.error('Error al cargar los datos del perfil:', error);
    });
});
</script>

<script>

document.addEventListener('DOMContentLoaded', () => {
  const email = localStorage.getItem('email');
  if (!email) {
    console.error("No se encontró el email en localStorage.");
    return;
  }

  
  fetch('http://localhost:5000/api/perfil/datos', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.success) {
        const editButton = document.querySelector('.settings-bar .option img[alt="Editar Perfil"]');
        if (editButton) {
          editButton.addEventListener('click', () => {
            const modalId =
              data.tipoUsuario === 'Deportista'
                ? 'modificarPerfilDeportistaModal'
                : 'modificarPerfilApasionadoModal';

            const modalElement = document.getElementById(modalId);
            if (modalElement) {
              const iframe = modalElement.querySelector('iframe');
              iframe.src = data.tipoUsuario === 'Deportista'
                ? 'modificarperfildeportista.html'
                : 'modificarperfilapasionado.html';

              const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
              modal.show();
            } else {
              console.error(`No se encontró el modal con ID: ${modalId}`);
            }
          });
        }
      } else {
        console.error('Error al obtener el tipo de usuario:', data.message);
      }
    })
    .catch((error) => console.error('Error al cargar los datos del usuario:', error));
});


</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<script>
document.addEventListener('DOMContentLoaded', async () => {
    const email = localStorage.getItem('email');
    if (!email) {
        console.error("No se encontró el email en localStorage.");
        return;
    }

    try {
        const response = await fetch('http://localhost:5000/api/perfil/stats', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email }),
        });

        const data = await response.json();
        console.log(" Datos recibidos del servidor:", data);

        if (data.success) {
            
            setTimeout(() => {
                const seguidoresStat = document.querySelector('[data-bs-target="#amigosModal"] .stat-number');
                const seguidosStat = document.querySelector('[data-bs-target="#seguidosModal"] .stat-number');
                const comunidadesStat = document.querySelector('[data-bs-target="#comunidadesModal"] .stat-number');

                if (seguidoresStat) {
                    seguidoresStat.textContent = data.stats.seguidores ?? "0";
                    console.log(`Seguidores actualizados a: ${data.stats.seguidores}`);
                } else {
                    console.error("Elemento de seguidores no encontrado.");
                }

                if (seguidosStat) {
                    seguidosStat.textContent = data.stats.seguidos ?? "0";
                    console.log(`Seguidos actualizados a: ${data.stats.seguidos}`);
                } else {
                    console.error("Elemento de seguidos no encontrado.");
                }

                if (comunidadesStat) {
                    comunidadesStat.textContent = data.stats.comunidades ?? "0";
                    console.log(`Comunidades actualizadas a: ${data.stats.comunidades}`);
                } else {
                    console.error("Elemento de comunidades no encontrado.");
                }
            }, 1000); 

        } else {
            console.error("Error al obtener estadísticas:", data.message);
        }
    } catch (error) {
        console.error("Error al obtener estadísticas del perfil:", error);
    }
});



</script>


</body>
</html>

